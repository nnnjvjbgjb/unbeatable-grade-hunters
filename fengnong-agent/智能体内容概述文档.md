1. # 智能体内容概述文档

   ### **1.1 项目背景**

   - **农业链路长、信息分散**：种植环节受**天气/病虫害/生育期**影响，供给端还要处理**库存/定价/上架/发货**；消费者端则在意“物美价廉”与“可信溯源”。传统“聊天机器人”难以落地到真实行动。
   - **我们的破题思路**：以 **MCP** 为中枢，把“能力”抽象成标准化的**工具**，让智能体在**编排层**生成可执行的**≤4 步计划**，通过工具完成外部操作（查天气、筛商品、写草稿文件等），并把**产物写入沙盒目录**供下载，同时输出**时间线**与**证据**，实现“**说 → 做 → 有据可依**”的闭环。

   ### **1.2 功能定位**

   **（1）农民侧・生产力智能体**

   - **A. 农事决策与日常运营**：作物档案/生育期管理、**天气驱动提醒**、**病虫害智能排查**、田块记录与季末复盘。
   - **B. 生产-供给联动**：**产量/出货预测**、**一键上架草稿**、**智能定价**、**发货建议**（结合天气与物流风险）。
   - **C. 经营与合规**：成本账本、政策/补贴节点提醒、**安全防呆**（标注来源与免责声明，禁止处方/违规用药）。

   **（2）消费者侧・购物智能体**

   - **D. 物美价廉发现**：语义搜索+筛选、**跨店价格对比**、**溢价提醒**、**组合购省钱**。
   - **E. 信任与体验**：产地溯源卡、到货 ETA 风险提示、**售后助手**。
   - **F. 个性化与长期价值**：饮食/过敏/本地直发偏好记忆，价格提醒。

   > **本次作业交付的 MVP（初级版）四项能力**
   > **G1** 天气驱动的种植提醒（农民）
   > **G2** “物美价廉”推荐 + **订单草稿**（消费者）
   > **G3** 一键**上架草稿**（农民）
   > **G4** **作物日历 & 待办**（导出 Markdown，页面可勾选）

   ### **1.3 核心特性**

   - **能说会做**：自然语言 → **计划 JSON（≤4 步）** → **MCP 工具执行** → **产物落盘（沙盒）** → **答案 + 时间线 + 证据**。

   - 可解释

     ：每次回答都包含

     - **Timeline（时间线）**：调用了哪些工具、耗时、输入参数摘要、产物路径；
     - **Evidence（证据）**：数据来源、更新时间、是否 **mock**（模拟数据回退）。

   - **安全合规**：仅允许写入 `apps/web/sandbox/**`；**农业建议统一免责声明**：“本回答仅为一般性提示，不构成处方或违规用药建议，请联系持证农技师。”

   - **可拓展**：多轮对话记忆（短期上下文 + 长期偏好）、语音输入/播报、外部 API/数据库、极简前端。

   > “问题 → 计划 → 工具 → 产物 → 证据”的全链路示意图

   ![ChatGPT Image 2025年10月23日 20_54_46](https://img2024.cnblogs.com/blog/3706323/202510/3706323-20251023205612906-2139315282.png)

   ------

   ## **二. 业务流程描述**

   ### **2.1 整体架构流程**

   > **三层架构图（前端/编排/工具），标注数据流、控制流与沙盒边界**。

   ![ChatGPT Image 2025年10月23日 20_46_53](https://img2024.cnblogs.com/blog/3706323/202510/3706323-20251023204754228-1460231741.png)

   ### **2.2 核心业务流程（四个 MVP）**

   **G1｜天气驱动的种植提醒（农民）**

   1. 解析意图（地区/作物/阶段）
   2. 调用 **Weather.get_forecast**（获取 7 日摘要；失败则 mock 回退并标注）
   3. 结合 `crops.json` 阶段规则生成 **Markdown 提醒**（≥3 条）+ **免责声明**
   4. 写入 `sandbox/notes/advice_*.md`，前端展示 **答案 + 时间线 + 证据 + 下载**

   **G2｜“物美价廉”推荐 + 订单草稿（消费者）**

   1. 解析（品类/上限价/本地直发/当季）
   2. **Commerce.catalog_search**（本地/当季加权 + 均价与**溢价%**）
   3. 生成候选项 → **create_order_draft**（订单草稿写入 `sandbox/orders/DRAFT_*.json`）
   4. 展示命中数、均价、溢价% 与草稿下载链接

   **G3｜一键上架草稿（农民）**

   1. 解析（标题/库存/单价/产地）
   2. **Commerce.create_listing_draft** → 写入 `sandbox/listings/LIST_*.json`
   3. 提示“草稿需确认才能上架”，展示下载链接、时间线与证据

   **G4｜作物日历 & 待办（农民）**

   1. 解析（作物/阶段/范围=14 天）
   2. 基于 `crops.json` 生成**每日待办**（含优先级/备注；雨天自动推迟“施药/施肥”）
   3. 导出 **Markdown 清单**（checkbox 可勾选）→ `sandbox/notes/calendar_*.md`
   4. 前端勾选回写（把完成状态写回本地）

   ### **2.3 数据流转（名词解释版）**

   - **输入**：自然语言（文本/语音）+ 记忆（`memory/<userId>.json`：默认**地区**、**常见作物**、**价格偏好**等）。

   - 检索

     ：

     - `products.csv`（商品清单，含价格、库存、产地、当季标签等）；
     - `crops.json`（作物→生育期→注意事项/14 日待办模板等）；
     - `faq.md`（常见问答与**数据更新时间**）。
       这些用于 **RAG**（Retrieval-Augmented Generation，检索增强生成）：先把相关事实找出来，再基于事实生成答案，**先证据后结论**。

   - 工具输出

     ：

     - `forecast`（天气预报结果对象：城市、未来天数、极端天气标记等）；
     - `items`（筛选后的商品数组：标题/价格/库存/本地直发/当季标签/溢价% 等）；
     - `path`（生成的**草稿文件路径**，用于下载）。
       以上都是**结构化 JSON**（可被程序继续处理的标准数据格式）。

   - 产物（Artifacts）

     ：

     - `sandbox/orders/*.json`（**订单草稿**）；
     - `sandbox/listings/*.json`（**上架草稿**）；
     - `sandbox/notes/*.md`（**Markdown 文档**：天气提醒/作物日历等）；
     - `sandbox/memory/*.json`（**记忆文件**：用户偏好与会话摘要）。
       “sandbox” 是我们的**受控输出目录**，所有文件都写在这里，保证安全与可下载。

   - 展示

     ：

     - **answer**（最终回答文本摘要）；
     - **timeline**（时间线：谁→何时→用什么工具→做了什么→结果如何）；
     - **evidence**（证据列表：引用的数据文件、来源与更新时间，以及是否使用了 **mock 模拟数据**）；
     - **下载链接**（点击即可获取刚刚生成的草稿/清单/报告）。